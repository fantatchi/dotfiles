{{- if ne .chezmoi.os "linux" -}}
{{- /* Linux 以外では実行しない（空出力でスキップ） */ -}}
{{- else -}}
#!/bin/bash
set -euo pipefail

echo "=== Claude Code hook の依存チェック ==="

# --- Linux 依存 ---
echo ""
echo "[Linux]"

install_if_missing() {
    local cmd="$1"
    local pkg="${2:-$1}"
    if command -v "$cmd" &>/dev/null; then
        echo "  [OK] $cmd"
    else
        echo "  [INSTALL] $cmd (apt: $pkg)"
        sudo apt-get update -qq && sudo apt-get install -y -qq "$pkg"
    fi
}

install_if_missing jq

# --- Windows 依存（WSL 環境のみ） ---
if command -v powershell.exe &>/dev/null; then
    echo ""
    echo "[Windows via WSL interop]"

    if powershell.exe -NoProfile -Command "if (Get-Module -ListAvailable -Name BurntToast) { exit 0 } else { exit 1 }" 2>/dev/null; then
        echo "  [OK] BurntToast"
    else
        echo "  [INSTALL] BurntToast"
        powershell.exe -NoProfile -Command "Install-Module -Name BurntToast -Force -Scope CurrentUser"
    fi
fi

echo ""
echo "依存チェック完了"
{{ end -}}
