---
name: context-load
description: 保存済みのプロジェクトコンテキストを読み込み、前回の作業状態を復帰する。セッション開始時に使う。
argument-hint: [project-id]
disable-model-invocation: true
allowed-tools: Read, Glob, Grep, Bash(git *), Bash(printenv *), Bash(basename *), Bash(ls *)
---

# コンテキスト読み込み

保存済みのプロジェクトコンテキストを読み込み、前回の作業状態を復帰する。

## 読み込み元

`$OBSIDIAN_VAULT/_ClaudeContext/{project-id}.md`

※ **必ず `printenv OBSIDIAN_VAULT` で実パスを取得**すること。

## プロジェクトの選択

### 引数あり

`$ARGUMENTS` で指定された値をプロジェクト識別子として使う。
部分一致で検索し、一意に特定できればそのまま読み込む（例: `ict` → `ict-pf.md`）。
複数マッチした場合は候補を AskUserQuestion で提示する。

### 引数なし

`_ClaudeContext/` 内の保存済みコンテキスト一覧を取得し、AskUserQuestion の選択肢として提示する。

- 各ファイルの frontmatter から `project`、`updated`、`branch` を読み取り、選択肢のラベルと説明に使う
- 例: `ict-pf` — 最終更新: 2025-02-10, ブランチ: feature/xxx
- git リポジトリ内にいる場合は、現在のリポジトリに対応するプロジェクトを推奨（選択肢の先頭に配置）
- 保存済みコンテキストが 0 件の場合は「保存済みコンテキストがありません」と案内

## 読み込み処理

### 1. コンテキストファイルの読み込み

`_ClaudeContext/{project-id}.md` を読み込み、内容を把握する。

### 2. 関連ログの検索

`_ClaudeLogs/` 内から、このプロジェクトに関連する直近のログを検索する：

- frontmatter の `project:` タグでマッチ
- 直近 5 件まで取得し、最新のものから概要を確認
- 関連ログがあれば、コンテキストの補足情報として統合

### 3. 現在の git 状態との比較

保存時と現在の状態を比較し、差分があれば警告する：

- ブランチが異なる場合: 「保存時のブランチ: `xxx` → 現在: `yyy`」
- 未コミットの変更がある場合: 注意喚起
- 保存時以降に新しいコミットがある場合: その旨を表示

### 4. コンテキストの提示

読み込んだ情報を整理して提示する：

```
## 前回のコンテキスト: {project-id}

**最終更新**: YYYY-MM-DD HH:mm
**ブランチ**: feature/xxx

### プロジェクト概要
（概要）

### 進行中の作業
（作業内容）

### 次のステップ
（次のアクション）

### ⚠️ 状態の変化（差分がある場合のみ）
（差分の詳細）

### 関連ログ（ある場合のみ）
（直近ログの要約）
```

## 注意事項

- 読み込み専用。コンテキストファイルを変更しない
- 大量のログファイルを読み込まないこと（直近 5 件まで）
- パスはプロジェクトルートからの相対パスで記録されているため、現在のマシンのパスと異なる場合がある
