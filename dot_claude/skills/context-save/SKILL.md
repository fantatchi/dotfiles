---
name: context-save
description: プロジェクトの作業状態を保存し、次回セッションで復帰可能にする。セッション終了時や作業の区切りで使う。
disable-model-invocation: true
allowed-tools: Read, Write, Edit, Glob, Bash(git *), Bash(echo *), Bash(mkdir *), Bash(basename *), Bash(date *)
---

# コンテキスト保存

現在のプロジェクトの作業状態を保存し、次回セッションで復帰できるようにする。

## 書き出し先

プロジェクトルートの `.claude/context.md`（上書き保存）

### プロジェクトルートの決定

1. `git rev-parse --show-toplevel` でリポジトリルートを取得
2. git リポジトリ外の場合は CWD をプロジェクトルートとする

### ディレクトリの確認

- `.claude/` ディレクトリが存在しなければ `mkdir -p` で作成する

## 保存内容

`./template.md` のフォーマットに従って書き出すこと。

### 情報の収集

以下の情報を収集してテンプレートに埋める：

- **project**: リポジトリのディレクトリ名（`basename` で取得）
- **git リモート URL**: `git remote get-url origin`（取得できない場合は空欄）
- **現在のブランチ**: `git branch --show-current`
- **git 状態**: `git status --short` の要約
- **直近のコミット**: `git log --oneline -5`
- **プロジェクト概要**: セッション中の作業内容から簡潔にまとめる
- **進行中の作業**: 現在取り組んでいるタスクや未完了の作業
- **判断メモ**: セッション中に行った重要な判断とその理由
- **次のステップ**: 次回セッションで着手すべきこと
- **重要ファイル**: 作業に関連する主要ファイル（プロジェクトルートからの相対パス）

### 既存ファイルの扱い

書き出し先に既存ファイルがある場合：
- まず既存ファイルを読み込む
- `## プロジェクト概要` は既存の内容を引き継ぎつつ、必要なら更新
- それ以外のセクション（ブランチ・状態、進行中の作業など）は最新情報で上書き
- `updated` の日時を更新する

## 注意事項

- パスはプロジェクトルートからの相対パスで記録する（マシン非依存）
- git リモート URL を frontmatter に記録する（マシン間でのプロジェクト同定用）
- セッション全体を振り返ってからまとめること
